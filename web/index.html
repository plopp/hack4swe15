<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="css/style.css" />
	<script type="text/javascript" src="js/base.js"></script>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
	<script type='text/javascript' src='js/overlaycanvas.js'></script>
	<script type='text/javascript' src='js/astar.js'></script>
</head>
<body>
<script type="text/javascript">
	var layerStyle = [[
	  {
	    "featureType": "transit",
	    "stylers": [
	      { "visibility": "off" }
	    ]
	  },{
	    "featureType": "landscape",
	    "stylers": [
	      { "saturation": -100 },
	      { "invert_lightness": true },
	      { "lightness": 7 }
	    ]
	  },{
	    "featureType": "poi",
	    "stylers": [
	      { "visibility": "off" }
	    ]
	  },{
	    "featureType": "water",
	    "stylers": [
	      { "saturation": -100 },
	      { "lightness": -77 },
	      { "color": "#000000" }
	    ]
	  },{
	    "featureType": "road",
	    "elementType": "geometry",
	    "stylers": [
	      { "visibility": "simplified" },
	      { "weight": 1.6 },
	      { "color": "#ffba01" }
	    ]
	  },{
	    "featureType": "administrative",
	    "stylers": [
	      { "visibility": "on" },
	      { "invert_lightness": true }
	    ]
	  },{
	    "featureType": "road",
	    "elementType": "labels",
	    "stylers": [
	      { "visibility": "off" }
	    ]
	  }
	],[
	  {
	    "featureType": "transit",
	    "stylers": [
	      { "visibility": "off" }
	    ]
	  },{
	    "featureType": "landscape",
	    "stylers": [
	      { "saturation": -40 },
	      { "invert_lightness": true },
	      { "lightness": 8 }
	    ]
	  },{
	    "featureType": "poi",
	    "stylers": [
	      { "visibility": "off" }
	    ]
	  },{
	    "featureType": "water",
	    "stylers": [
	      { "saturation": -100 },
	      { "lightness": -77 },
	      { "color": "#000000" }
	    ]
	  },{
	    "featureType": "road",
	    "elementType": "geometry",
	    "stylers": [
	      { "visibility": "simplified" },
	      { "weight": 2.6 },
	      { "color": "#baff01" }
	    ]
	  },{
	    "featureType": "administrative",
	    "stylers": [
	      { "visibility": "on" },
	      { "invert_lightness": true }
	    ]
	  },{
	    "featureType": "road",
	    "elementType": "labels",
	    "stylers": [
	      { "visibility": "off" }
	    ]
	  }
	]];
	</script>
		<div id="map"></div>
		<div id="overlay"></div>
		<div id="graph"></div>
		<div id="params"></div>
		<div id="debug"></div>

		<script type="text/javascript">
				window.addEventListener('load', function() {
					var waitingForStartClick = false;
					var waitingForEndClick = false;
					var butts =document.getElementsByTagName("button");
					for(var z =0; z < butts.length; z++){
						var elem = butts[z];
						//console.log(elem);
						elem.onclick = function(event){
							var id = event.toElement.id;
							switch(id){
								case "setStart":
									waitingForStartClick = true;
									console.log("Start");
									break;
								case "setEnd":
									waitingForEndClick = true;
									console.log("End");
									break;
							}
						}
					}

					var centerlatlng = new google.maps.LatLng(60.627800,15.660929);

					var myOptions = {
						disableDefaultUI: true,
						zoom:14,
						center:centerlatlng,
						mapTypeId:google.maps.MapTypeId.SATELLITE,
						draggableCursor:'crosshair',
						//styles:layerStyle[0],
						scaleControl:false
					};

					var map = new google.maps.Map(document.getElementById("map"),myOptions);

					var canvasElement = document.createElement('canvas');
					canvasElement.style.width = '100%';
					canvasElement.style.height = '100%';

					var cntDiv = document.createElement('div');
					cntDiv.style.position = 'absolute';
					cntDiv.style.width = '100%';
					cntDiv.style.height = '100%';
					cntDiv.appendChild(canvasElement);

					var sw = new google.maps.LatLng(60.627800,15.660929);
					var ne = new google.maps.LatLng(60.645859,15.724571);
					var bn = new google.maps.LatLngBounds(sw,ne);

					overlay = new SimulatorOverlay(bn, cntDiv, map,function(){
						console.log("Added overlay");
					}/*,sim*/);

					var prepareSeach = function(data){
						var graph = new Graph(data);
						startx = 0;
						starty = 0;
						endx = 511;
						endy = 511;
						var start = graph.grid[startx][starty];
						var end = graph.grid[endx][endy];

						var ctx = canvasElement.getContext("2d");
						//ctx.fillStyle = "#FF0000";
						//ctx.strokeStyle = "#FF0000";
						ctx.rect(0,0,canvasElement.width,canvasElement.height);
						console.log("Area size: "+canvasElement.width+"px "+canvasElement.height+"px");
						ctx.stroke();
						
						ctx.beginPath();
						ctx.strokeStyle = 'blue';
						
						ctx.moveTo(startx,starty);
						var result = astar.search(graph, start, end);
						for (var i = 0; i < result.length; i++) {
							var x = result[i].x;
							var y = result[i].y;
							ctx.lineTo(x,y);
							ctx.moveTo(x,y);
						};	
						ctx.stroke();
					}

					finder = window.initSearch(map);
					finder.getMergedArray(prepareSeach);

					// result is an array containing the shortest path
				});
				
		</script>	
		<div class="guidiv">
			<button id="setStart">Set start point</button>
			<button id="setEnd">Set end point</button>
		</div>
</body>
</html>